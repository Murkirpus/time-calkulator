<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
    <title>Калькулятор Pro</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Калькулятор Pro">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Калькулятор Pro">
    <meta name="msapplication-TileColor" content="#1a1a2e">
    <meta name="msapplication-TileImage" content="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='192' height='192' viewBox='0 0 192 192'%3E%3Cdefs%3E%3ClinearGradient id='a' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%231a1a2e'/%3E%3Cstop offset='50%25' stop-color='%2316213e'/%3E%3Cstop offset='100%25' stop-color='%230f3460'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='192' height='192' fill='url(%23a)' rx='42'/%3E%3Ccircle cx='96' cy='96' r='64' fill='%234f46e5' fill-opacity='0.9'/%3E%3Ctext x='96' y='112' font-family='Arial, sans-serif' font-size='64' fill='%23ffffff' text-anchor='middle' font-weight='800'%3E+%3C/text%3E%3C/svg%3E">
    
    <!-- Favicon and Apple Touch Icons -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='32' height='32' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' fill='%231a1a2e' rx='8'/%3E%3Ccircle cx='16' cy='16' r='12' fill='%234f46e5'/%3E%3Ctext x='16' y='20' font-family='Arial' font-size='14' fill='white' text-anchor='middle' font-weight='bold'%3E+%3C/text%3E%3C/svg%3E">
    
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='180' viewBox='0 0 180 180'%3E%3Cdefs%3E%3ClinearGradient id='f' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%231a1a2e'/%3E%3Cstop offset='50%25' stop-color='%2316213e'/%3E%3Cstop offset='100%25' stop-color='%230f3460'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='180' height='180' fill='url(%23f)' rx='36'/%3E%3Ccircle cx='90' cy='90' r='60' fill='%234f46e5' fill-opacity='0.95'/%3E%3Ctext x='90' y='105' font-family='Arial, sans-serif' font-size='60' fill='%23ffffff' text-anchor='middle' font-weight='800'%3E+%3C/text%3E%3C/svg%3E">
    
    <link rel="apple-touch-icon" sizes="152x152" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='152' height='152' viewBox='0 0 152 152'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%231a1a2e'/%3E%3Cstop offset='50%25' stop-color='%2316213e'/%3E%3Cstop offset='100%25' stop-color='%230f3460'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='152' height='152' fill='url(%23g)' rx='32'/%3E%3Ccircle cx='76' cy='76' r='50' fill='%234f46e5' fill-opacity='0.95'/%3E%3Ctext x='76' y='88' font-family='Arial, sans-serif' font-size='50' fill='%23ffffff' text-anchor='middle' font-weight='800'%3E+%3C/text%3E%3C/svg%3E">
    
    <link rel="apple-touch-icon" sizes="120x120" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='120' height='120' viewBox='0 0 120 120'%3E%3Cdefs%3E%3ClinearGradient id='h' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%231a1a2e'/%3E%3Cstop offset='50%25' stop-color='%2316213e'/%3E%3Cstop offset='100%25' stop-color='%230f3460'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='120' height='120' fill='url(%23h)' rx='26'/%3E%3Ccircle cx='60' cy='60' r='40' fill='%234f46e5' fill-opacity='0.95'/%3E%3Ctext x='60' y='72' font-family='Arial, sans-serif' font-size='40' fill='%23ffffff' text-anchor='middle' font-weight='800'%3E+%3C/text%3E%3C/svg%3E">
    
    <!-- Manifest -->
    <link rel="manifest" href="data:application/manifest+json;base64,ewogICJuYW1lIjogItCa0LDQu9GM0LrRg9C70Y/RgtC+0YAgUHJvIiwKICAic2hvcnRfbmFtZSI6ICLQmtCw0LvRjNC60YPQu9GP0YLQvtGAIiwKICAiZGVzY3JpcHRpb24iOiAi0KHQvtCy0YDQtdC80LXQvdC90YvQuSDQutCw0LvRjNC60YPQu9GP0YLQvtGAINGBINCy0YDQtdC80LXQvdC10LwiLAogICJzdGFydF91cmwiOiAiLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzFhMWEyZSIsCiAgInRoZW1lX2NvbG9yIjogIiMxYTFhMmUiLAogICJvcmllbnRhdGlvbiI6ICJwb3J0cmFpdCIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbCwlM0NzdmcgeG1sbnMlM0QnaHR0cCUzQSUyRiUyRnd3dy53My5vcmclMkYyMDAwJTJGc3ZnJyB3aWR0aCUzRCc3MicgaGVpZ2h0JTNEJzcyJyB2aWV3Qm94JTNEJzAlMjAwJTIwNzIlMjA3MiclM0UlM0NkZWZzJTNFJTNDbGluZWFyR3JhZGllbnQgaWQlM0QnYScgeDElM0QnMCUyNScgeTElM0QnMCUyNScgeDIlM0QnMTAwJTI1JyB5MiUzRCcxMDAlMjUnJTNFJTNDc3RvcCBvZmZzZXQlM0QnMCUyNScgc3RvcC1jb2xvciUzRCclMjMxYTFhMmUnJTJGJTNFJTNDc3RvcCBvZmZzZXQlM0QnMTAwJTI1JyBzdG9wLWNvbG9yJTNEJyUyMzBmMzQ2MCclMkYlM0UlM0MlMkZsaW5lYXJHcmFkaWVudCUzRSUzQyUyRmRlZnMlM0UlM0NyZWN0IHdpZHRoJTNEJzcyJyBoZWlnaHQlM0QnNzInIGZpbGwlM0QndXJsJTI4JTIzYSUyOScgcnglM0QnMTYnJTJGJTNFJTNDY2lyY2xlIGN4JTNEJzM2JyBjeSUzRCczNicgciUzRCcyNCcgZmlsbCUzRCclMjM0ZjQ2ZTUnJTJGJTNFJTNDdGV4dCB4JTNEJzM2JyB5JTNEJTM0NCcgZm9udC1mYW1pbHklM0QnQXJpYWwlMkMlMjBzYW5zLXNlcmlmJyBmb250LXNpemUlM0QnMjQnIGZpbGwlM0QnJTIzZmZmZmZmJyB0ZXh0LWFuY2hvciUzRCdtaWRkbGUnIGZvbnQtd2VpZ2h0JTNEJzgwMCclM0UlMkIlM0MlMkZ0ZXh0JTNFJTNDJTJGc3ZnJTNFIiwKICAgICAgInNpemVzIjogIjcyeDcyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyB4bWxucyUzRCdodHRwJTNBJTJGJTJGd3d3LnczLm9yZyUyRjIwMDAlMkZzdmcnIHdpZHRoJTNEJzk2JyBoZWlnaHQlM0QnOTYnIHZpZXdCb3glM0QnMCUyMDAlMjA5NiUyMDk2JyUzRSUzQ2RlZnMlM0UlM0NsaW5lYXJHcmFkaWVudCUyMGlkJTNEJ2InJTIweDElM0QnMCUyNSclMjB5MSUzRCcwJTI1JyUyMHgyJTNEJzEwMCUyNSclMjB5MiUzRCcxMDAlMjUnJTNFJTNDc3RvcCUyMG9mZnNldCUzRCcwJTI1JyUyMHN0b3AtY29sb3IlM0QnJTIzMWExYTJlJyUyRiUzRSUzQ3N0b3AlMjBvZmZzZXQlM0QnNTAlMjUnJTIwc3RvcC1jb2xvciUzRCclMjMxNjIxM2UnJTJGJTNFJTNDc3RvcCUyMG9mZnNldCUzRCcxMDAlMjUnJTIwc3RvcC1jb2xvciUzRCclMjMwZjM0NjAnJTJGJTNFJTNDJTJGbGluZWFyR3JhZGllbnQlM0UlM0MlMkZkZWZzJTNFJTNDcmVjdCUyMHdpZHRoJTNEJzk2JyUyMGhlaWdodCUzRCc5NiclMjBmaWxsJTNEJ3VybCUyOCUyM2IlMjknJTIwcnglM0QnMjAnJTJGJTNFJTNDY2lyY2xlJTIwY3glM0QnNDgnJTIwY3klM0QnNDgnJTIwciUzRCczMCclMjBmaWxsJTNEJyUyMzRmNDZlNSclMjBmaWxsLW9wYWNpdHklM0QnMC45JyUyRiUzRSUzQ3RleHQlMjB4JTNEJzQ4JyUyMHklM0QnNTgnJTIwZm9udC1mYW1pbHklM0QnQXJpYWwlMkMlMjBzYW5zLXNlcmlmJyUyMGZvbnQtc2l6ZSUzRCczMiclMjBmaWxsJTNEJyUyM2ZmZmZmZiclMjB0ZXh0LWFuY2hvciUzRCdtaWRkbGUnJTIwZm9udC13ZWlnaHQlM0QnODAwJyUzRSUyQiUzQyUyRnRleHQlM0UlM0MlMkZzdmclM0UiLAogICAgICAic2l6ZXMiOiAiOTZ4OTYiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnJTIweG1sbnMlM0QnaHR0cCUzQSUyRiUyRnd3dy53My5vcmclMkYyMDAwJTJGc3ZnJyUyMHdpZHRoJTNEJzEyOCclMjBoZWlnaHQlM0QnMTI4JyUyMHZpZXdCb3glM0QnMCUyMDAlMjAxMjglMjAxMjgnJTNFJTNDZGVmcyUzRSUzQ2xpbmVhckdyYWRpZW50JTIwaWQlM0QnYyclMjB4MSUzRCcwJTI1JyUyMHkxJTNEJzAlMjUnJTIweDIlM0QnMTAwJTI1JyUyMHkyJTNEJzEwMCUyNSclM0UlM0NzdG9wJTIwb2Zmc2V0JTNEJzAlMjUnJTIwc3RvcC1jb2xvciUzRCclMjMxYTFhMmUnJTJGJTNFJTNDc3RvcCUyMG9mZnNldCUzRCc1MCUyNSclMjBzdG9wLWNvbG9yJTNEJyUyMzE2MjEzZSclMkYlM0UlM0NzdG9wJTIwb2Zmc2V0JTNEJzEwMCUyNSclMjBzdG9wLWNvbG9yJTNEJyUyMzBmMzQ2MCclMkYlM0UlM0MlMkZsaW5lYXJHcmFkaWVudCUzRSUzQyUyRmRlZnMlM0UlM0NyZWN0JTIwd2lkdGglM0QnMTI4JyUyMGhlaWdodCUzRCcxMjgnJTIwZmlsbCUzRCd1cmwlMjglMjNjJTI5JyUyMHJ4JTNEJzI4JyUyRiUzRSUzQ2NpcmNsZSUyMGN4JTNEJzY0JyUyMGN5JTNEJzY0JyUyMHIlM0QnNDAnJTIwZmlsbCUzRCclMjM0ZjQ2ZTUnJTIwZmlsbC1vcGFjaXR5JTNEJzAuOSclMkYlM0UlM0N0ZXh0JTIweCUzRCc2NCclMjB5JTNEJzc2JyUyMGZvbnQtZmFtaWx5JTNEJydBcmlhbCUyQyUyMHNhbnMtc2VyaWYnJTIwZm9udC1zaXplJTNEJzQwJyUyMGZpbGwlM0QnJTIzZmZmZmZmJyUyMHRleHQtYW5jaG9yJTNEJ21pZGRsZSclMjBmb250LXdlaWdodCUzRCc4MDAnJTNFJTJCJTNDJTJGdGV4dCUzRSUzQyUyRnN2ZyUzRSIsCiAgICAgICJzaXplcyI6ICIxMjh4MTI4IiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyUyMHhtbG5zJTNEJ2h0dHAlM0ElMkYlMkZ3d3cudzMub3JnJTJGMjAwMCUyRnN2ZyclMjB3aWR0aCUzRCcxOTInJTIwaGVpZ2h0JTNEJzE5MiclMjB2aWV3Qm94JTNEJzAlMjAwJTIwMTkyJTIwMTkyJyUzRSUzQ2RlZnMlM0UlM0NsaW5lYXJHcmFkaWVudCUyMGlkJTNEJ2QnJTIweDElM0QnMCUyNSclMjB5MSUzRCcwJTI1JyUyMHgyJTNEJzEwMCUyNSclMjB5MiUzRCcxMDAlMjUnJTNFJTNDc3RvcCUyMG9mZnNldCUzRCcwJTI1JyUyMHN0b3AtY29sb3IlM0QnJTIzMWExYTJlJyUyRiUzRSUzQ3N0b3AlMjBvZmZzZXQlM0QnNTAlMjUnJTIwc3RvcC1jb2xvciUzRCclMjMxNjIxM2UnJTJGJTNFJTNDc3RvcCUyMG9mZnNldCUzRCcxMDAlMjUnJTIwc3RvcC1jb2xvciUzRCclMjMwZjM0NjAnJTJGJTNFJTNDJTJGbGluZWFyR3JhZGllbnQlM0UlM0MlMkZkZWZzJTNFJTNDcmVjdCUyMHdpZHRoJTNEJzE5MiclMjBoZWlnaHQlM0QnMTkyJyUyMGZpbGwlM0QndXJsJTI4JTIzZCUyOSclMjByeCUzRCc0MicyRiUzRSUzQ2NpcmNsZSUyMGN4JTNEJzk2JyUyMGN5JTNEJzk2JyUyMHIlM0QnNjQnJTIwZmlsbCUzRCclMjM0ZjQ2ZTUnJTIwZmlsbC1vcGFjaXR5JTNEJzAuOSclMkYlM0UlM0N0ZXh0JTIweCUzRCc5NiclMjB5JTNEJzExMiclMjBmb250LWZhbWlseSUzRCdBcmlhbCUyQyUyMHNhbnMtc2VyaWYnJTIwZm9udC1zaXplJTNEJzY0JyUyMGZpbGwlM0QnJTIzZmZmZmZmJyUyMHRleHQtYW5jaG9yJTNEJ21pZGRsZSclMjBmb250LXdlaWdodCUzRCc4MDAnJTNFJTJCJTNDJTJGdGV4dCUzRSUzQyUyRnN2ZyUzRSIsCiAgICAgICJzaXplcyI6ICIxOTJ4MTkyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIsCiAgICAgICJwdXJwb3NlIjogImFueSBtYXNrYWJsZSIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sLCUzQ3N2ZyUyMHhtbG5zJTNEJ2h0dHAlM0ElMkYlMkZ3d3cudzMub3JnJTJGMjAwMCUyRnN2ZyclMjB3aWR0aCUzRCc1MTInJTIwaGVpZ2h0JTNEJzUxMiclMjB2aWV3Qm94JTNEJzAlMjAwJTIwNTEyJTIwNTEyJyUzRSUzQ2RlZnMlM0UlM0NsaW5lYXJHcmFkaWVudCUyMGlkJTNEJ2UnJTIweDElM0QnMCUyNSclMjB5MSUzRCcwJTI1JyUyMHgyJTNEJzEwMCUyNSclMjB5MiUzRCcxMDAlMjUnJTNFJTNDc3RvcCUyMG9mZnNldCUzRCcwJTI1JyUyMHN0b3AtY29sb3IlM0QnJTIzMWExYTJlJyUyRiUzRSUzQ3N0b3AlMjBvZmZzZXQlM0QnNTAlMjUnJTIwc3RvcC1jb2xvciUzRCclMjMxNjIxM2UnJTJGJTNFJTNDc3RvcCUyMG9mZnNldCUzRCcxMDAlMjUnJTIwc3RvcC1jb2xvciUzRCclMjMwZjM0NjAnJTJGJTNFJTNDJTJGbGluZWFyR3JhZGllbnQlM0UlM0MlMkZkZWZzJTNFJTNDcmVjdCUyMHdpZHRoJTNEJzUxMiclMjBoZWlnaHQlM0QnNTEyJyUyMGZpbGwlM0QndXJsJTI4JTIzZSUyOSclMjByeCUzRCcxMTInJTJGJTNFJTNDY2lyY2xlJTIwY3glM0QnMjU2JyUyMGN5JTNEJzI1NiclMjByJTNEJzE2OCclMjBmaWxsJTNEJyUyMzRmNDZlNSclMjBmaWxsLW9wYWNpdHklM0QnMC45JyUyRiUzRSUzQ3RleHQlMjB4JTNEJzI1NiclMjB5JTNEJzMwMCclMjBmb250LWZhbWlseSUzRCdBcmlhbCUyQyUyMHNhbnMtc2VyaWYnJTIwZm9udC1zaXplJTNEJzE2MCclMjBmaWxsJTNEJyUyM2ZmZmZmZiclMjB0ZXh0LWFuY2hvciUzRCdtaWRkbGUnJTIwZm9udC13ZWlnaHQlM0QnODAwJyUzRSUyQiUzQyUyRnRleHQlM0UlM0MlMkZzdmclM0UiLAogICAgICAic2l6ZXMiOiAiNTEyeDUxMiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiLAogICAgICAicHVycG9zZSI6ICJhbnkgbWFza2FibGUiCiAgICB9CiAgXQp9">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            overflow-x: hidden;
        }

        .calculator {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            padding: 25px;
            width: 100%;
            max-width: 380px;
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }

        .header h1 {
            color: #ffffff;
            font-size: 1.8rem;
            font-weight: 300;
            margin-bottom: 5px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .header p {
            color: #a8a8b3;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .install-btn-header {
            position: absolute;
            top: 0;
            right: 0;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            border-radius: 12px;
            color: white;
            padding: 8px 16px;
            font-size: 0.8rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            transition: all 0.2s ease;
            display: none !important;
        }

        /* Mode Toggle */
        .mode-toggle {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .mode-btn {
            flex: 1;
            background: transparent;
            border: none;
            color: #a8a8b3;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.15s ease; /* В 2 раза быстрее */
            font-size: 0.9rem;
            font-weight: 500;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
        }

        .display {
            background: linear-gradient(135deg, #2d2d44 0%, #1a1a2e 100%);
            border-radius: 15px;
            padding: 25px 20px;
            margin-bottom: 20px;
            text-align: right;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: inset 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .display-text {
            color: #ffffff;
            font-size: 2.2rem;
            font-weight: 300;
            line-height: 1.2;
            word-wrap: break-word;
            min-height: 45px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }

        .display-expression {
            color: #a8a8b3;
            font-size: 0.95rem;
            margin-bottom: 10px;
            min-height: 18px;
            opacity: 0.8;
        }

        .time-display {
            font-size: 1.8rem;
            line-height: 1.3;
        }

        .buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .time-buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.2rem;
            font-weight: 500;
            height: 65px;
            cursor: pointer;
            transition: all 0.1s ease; /* В 2 раза быстрее */
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 6px 18px rgba(79, 70, 229, 0.3);
            position: relative;
            overflow: hidden;
            touch-action: manipulation; /* Оставляем для убирания 300ms задержки */
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .btn-time {
            background: linear-gradient(135deg, #8b5cf6 0%, #a855f7 100%);
            height: 45px;
            font-size: 0.9rem;
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.25s; /* В 2 раза быстрее */
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:active {
            transform: scale(0.95);
            box-shadow: 0 3px 8px rgba(79, 70, 229, 0.4);
        }

        .btn.operator {
            background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
            box-shadow: 0 6px 18px rgba(245, 158, 11, 0.3);
        }

        .btn.clear {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 6px 18px rgba(239, 68, 68, 0.3);
        }

        .btn.equals {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 6px 18px rgba(16, 185, 129, 0.3);
        }

        .btn.zero {
            grid-column: span 2;
        }

        .btn.number {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            box-shadow: 0 6px 18px rgba(107, 114, 128, 0.3);
        }

        .hidden {
            display: none !important;
        }

        /* Time mode specific styles */
        .time-mode .display-text {
            font-size: 1.6rem;
            text-align: left;
            justify-content: flex-start;
            line-height: 1.4;
        }

        .time-input-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .time-value {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: white;
            padding: 8px 12px;
            font-size: 0.9rem;
            min-width: 60px;
            text-align: center;
        }

        .time-unit {
            color: #a8a8b3;
            font-size: 0.8rem;
            font-weight: 500;
        }

        /* Responsive Design */
        @media (max-width: 480px) {
            .calculator {
                padding: 18px;
                margin: 8px;
                max-width: none;
            }

            .display-text {
                font-size: 1.9rem;
            }

            .btn {
                height: 55px;
                font-size: 1.1rem;
            }

            .btn-time {
                height: 40px;
                font-size: 0.8rem;
            }

            .buttons, .time-buttons {
                gap: 8px;
            }

            .time-buttons {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        /* PWA Install Prompt */
        .install-prompt {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(79, 70, 229, 0.4);
            transition: bottom 0.15s ease; /* В 2 раза быстрее */
            z-index: 1000;
            text-align: center;
            max-width: 300px;
            width: 90%;
        }

        .install-prompt.show {
            bottom: 20px;
        }

        .install-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 15px;
            margin-top: 10px;
            cursor: pointer;
            transition: all 0.1s ease; /* В 2 раза быстрее */
        }

        .install-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .close-prompt {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            float: right;
            opacity: 0.7;
        }

        .close-prompt:hover {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="calculator">
        <div class="header">
            <button class="install-btn-header" id="installBtnHeader" onclick="installApp()">📱 Установить</button>
            <h1>Калькулятор Pro</h1>
            <p>Обычный режим & Калькулятор времени</p>
        </div>

        <!-- Mode Toggle -->
        <div class="mode-toggle">
            <button class="mode-btn active" onclick="switchMode('normal')">Обычный</button>
            <button class="mode-btn" onclick="switchMode('time')">Время</button>
        </div>

        <div class="display">
            <div class="display-expression" id="expression"></div>
            <div class="display-text" id="result">0</div>
        </div>

        <!-- Time Unit Buttons (Only in time mode) -->
        <div class="time-buttons hidden" id="timeButtons">
            <button class="btn btn-time" onclick="addTimeUnit('year')">Year</button>
            <button class="btn btn-time" onclick="addTimeUnit('day')">Day</button>
            <button class="btn btn-time" onclick="addTimeUnit('hour')">Hour</button>
            <button class="btn btn-time" onclick="addTimeUnit('min')">Min</button>
            <button class="btn btn-time" onclick="addTimeUnit('sec')">Sec</button>
        </div>

        <!-- Normal Calculator Buttons -->
        <div class="buttons" id="normalButtons">
            <button class="btn clear" onclick="clearAll()">AC</button>
            <button class="btn clear" onclick="clearEntry()">C</button>
            <button class="btn operator" onclick="appendOperator('/')">&divide;</button>
            <button class="btn operator" onclick="appendOperator('*')">&times;</button>

            <button class="btn number" onclick="appendNumber('7')">7</button>
            <button class="btn number" onclick="appendNumber('8')">8</button>
            <button class="btn number" onclick="appendNumber('9')">9</button>
            <button class="btn operator" onclick="appendOperator('-')">−</button>

            <button class="btn number" onclick="appendNumber('4')">4</button>
            <button class="btn number" onclick="appendNumber('5')">5</button>
            <button class="btn number" onclick="appendNumber('6')">6</button>
            <button class="btn operator" onclick="appendOperator('+')">+</button>

            <button class="btn number" onclick="appendNumber('1')">1</button>
            <button class="btn number" onclick="appendNumber('2')">2</button>
            <button class="btn number" onclick="appendNumber('3')">3</button>
            <button class="btn number" onclick="appendNumber('.')">.</button>

            <button class="btn number zero" onclick="appendNumber('0')">0</button>
            <button class="btn number" onclick="appendNumber('00')">00</button>
            <button class="btn equals" onclick="calculate()">=</button>
        </div>

        <!-- Time Calculator Buttons -->
        <div class="buttons hidden" id="timeCalculatorButtons">
            <button class="btn clear" onclick="clearAll()">AC</button>
            <button class="btn clear" onclick="clearEntry()">C</button>
            <button class="btn operator" onclick="appendOperator('+')" title="Сложить время">+</button>
            <button class="btn operator" onclick="appendOperator('-')" title="Вычесть время">−</button>

            <button class="btn number" onclick="appendNumber('7')">7</button>
            <button class="btn number" onclick="appendNumber('8')">8</button>
            <button class="btn number" onclick="appendNumber('9')">9</button>
            <button class="btn operator" onclick="showCurrentTime()" title="Текущее время">Now</button>

            <button class="btn number" onclick="appendNumber('4')">4</button>
            <button class="btn number" onclick="appendNumber('5')">5</button>
            <button class="btn number" onclick="appendNumber('6')">6</button>
            <button class="btn operator" onclick="convertTime()" title="Показать полное разложение">Full</button>

            <button class="btn number" onclick="appendNumber('1')">1</button>
            <button class="btn number" onclick="appendNumber('2')">2</button>
            <button class="btn number" onclick="appendNumber('3')">3</button>
            <button class="btn number" onclick="appendNumber('.')">.</button>

            <button class="btn number zero" onclick="appendNumber('0')">0</button>
            <button class="btn number" onclick="appendNumber('00')">00</button>
            <button class="btn equals" onclick="calculateTime()">=</button>
        </div>
    </div>

    <!-- PWA Install Prompt -->
    <div class="install-prompt" id="installPrompt">
        <button class="close-prompt" onclick="hideInstallPrompt()">&times;</button>
        <div>Установить приложение?</div>
        <button class="install-btn" onclick="installApp()">Установить</button>
    </div>

    <script>
        // Global variables
        let currentMode = 'normal';
        let currentInput = '';
        let operator = '';
        let previousInput = '';
        let shouldResetDisplay = false;
        let deferredPrompt;
        let currentTimeUnit = '';
        let timeExpression = [];

        const resultDisplay = document.getElementById('result');
        const expressionDisplay = document.getElementById('expression');
        const installPrompt = document.getElementById('installPrompt');
        const installBtnHeader = document.getElementById('installBtnHeader');
        const normalButtons = document.getElementById('normalButtons');
        const timeButtons = document.getElementById('timeButtons');
        const timeCalculatorButtons = document.getElementById('timeCalculatorButtons');

        // Time conversion constants (to seconds)
        const TIME_UNITS = {
            sec: 1,
            min: 60,
            hour: 3600,
            day: 86400,
            year: 31536000 // 365 days
        };

        const TIME_LABELS = {
            sec: 'сек',
            min: 'мин',
            hour: 'ч',
            day: 'дн',
            year: 'лет'
        };

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // Создаем более простой service worker
                const swCode = `
                    const CACHE_NAME = 'calculator-pro-v2';
                    
                    self.addEventListener('install', (event) => {
                        console.log('Service Worker: Installed');
                        self.skipWaiting();
                    });
                    
                    self.addEventListener('activate', (event) => {
                        console.log('Service Worker: Active');
                        event.waitUntil(self.clients.claim());
                    });
                    
                    self.addEventListener('fetch', (event) => {
                        // Возвращаем запрос как есть для простоты
                        event.respondWith(fetch(event.request));
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then((registration) => {
                        console.log('SW registered successfully');
                        // Показываем кнопку установки после регистрации SW
                        setTimeout(showInstallButton, 1000);
                    })
                    .catch((error) => {
                        console.log('SW registration failed');
                        // Показываем кнопку установки даже если SW не зарегистрировался
                        showInstallButton();
                    });
            });
        } else {
            // Если нет поддержки SW, все равно показываем кнопку
            showInstallButton();
        }

        // Показать кнопку установки
        function showInstallButton() {
            if (installBtnHeader) {
                installBtnHeader.classList.add('show');
            }
            // Также показываем промпт через время
            setTimeout(() => {
                if (installPrompt && !window.matchMedia('(display-mode: standalone)').matches) {
                    installPrompt.classList.add('show');
                }
            }, 3000);
        }

        // PWA Install Events
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('beforeinstallprompt fired');
            e.preventDefault();
            deferredPrompt = e;
            showInstallButton();
        });

        window.addEventListener('appinstalled', (evt) => {
            console.log('App installed');
            hideInstallPrompt();
            if (installBtnHeader) {
                installBtnHeader.style.display = 'none';
            }
        });

        function installApp() {
            if (deferredPrompt) {
                // Используем нативный промпт браузера
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    }
                    deferredPrompt = null;
                    hideInstallPrompt();
                });
            } else {
                // Показываем инструкции для ручной установки
                const isChrome = navigator.userAgent.includes('Chrome');
                const isSamsung = navigator.userAgent.includes('SamsungBrowser');
                const isFirefox = navigator.userAgent.includes('Firefox');
                
                let instructions = '';
                
                if (isChrome || isSamsung) {
                    instructions = `Для установки:
1. Нажмите ⋮ (меню) в браузере
2. Выберите "Добавить на главный экран"
3. Нажмите "Добавить"`;
                } else if (isFirefox) {
                    instructions = `Для установки:
1. Нажмите ⋮ (меню) в браузере  
2. Выберите "Установить"
3. Нажмите "Добавить"`;
                } else {
                    instructions = `Для установки:
1. Откройте меню браузера
2. Найдите "Добавить на главный экран" или "Установить"
3. Подтвердите установку`;
                }
                
                alert(instructions);
            }
        }

        function hideInstallPrompt() {
            installPrompt.classList.remove('show');
        }

        // Mode switching
        function switchMode(mode) {
            currentMode = mode;
            const modeButtons = document.querySelectorAll('.mode-btn');
            
            modeButtons.forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (mode === 'normal') {
                normalButtons.classList.remove('hidden');
                timeButtons.classList.add('hidden');
                timeCalculatorButtons.classList.add('hidden');
                document.querySelector('.calculator').classList.remove('time-mode');
            } else {
                normalButtons.classList.add('hidden');
                timeButtons.classList.remove('hidden');
                timeCalculatorButtons.classList.remove('hidden');
                document.querySelector('.calculator').classList.add('time-mode');
            }

            clearAll();
        }

        // Normal Calculator Functions
        // Оптимизация для быстрого ввода
        let updateDisplayTimeout;
        let fastInputMode = false;

        function updateDisplay() {
            if (currentMode === 'normal') {
                resultDisplay.textContent = currentInput || '0';
                
                let expression = '';
                if (previousInput && operator) {
                    expression = `${previousInput} ${getOperatorSymbol(operator)}`;
                    if (currentInput && !shouldResetDisplay) {
                        expression += ` ${currentInput}`;
                    }
                }
                expressionDisplay.textContent = expression;
            } else {
                updateTimeDisplay();
            }
        }

        function updateDisplayFast() {
            // Дебаунсинг для сверхбыстрого ввода
            clearTimeout(updateDisplayTimeout);
            fastInputMode = true;
            
            updateDisplayTimeout = setTimeout(() => {
                fastInputMode = false;
                updateDisplay();
            }, 50); // Обновляем дисплей только через 50ms после последнего ввода
            
            // Мгновенно обновляем только результат для быстрого фидбека
            if (currentMode === 'normal') {
                resultDisplay.textContent = currentInput || '0';
            }
        }

        function getOperatorSymbol(op) {
            const symbols = {
                '+': '+',
                '-': '−',
                '*': '×',
                '/': '÷'
            };
            return symbols[op] || op;
        }

        function appendNumber(number) {
            if (shouldResetDisplay) {
                currentInput = '';
                shouldResetDisplay = false;
            }

            if (number === '.' && currentInput.includes('.')) {
                return;
            }

            if (currentInput === '0' && number !== '.') {
                currentInput = number;
            } else {
                currentInput += number;
            }

            // Используем быстрое обновление при быстром вводе
            updateDisplayFast();
        }

        function appendOperator(op) {
            if (currentMode === 'time') {
                if (currentInput === '' && timeExpression.length === 0) {
                    return;
                }
                
                if (currentInput !== '') {
                    if (currentTimeUnit === '') {
                        alert('Выберите единицу времени!');
                        return;
                    }
                    
                    timeExpression.push({
                        value: parseFloat(currentInput),
                        unit: currentTimeUnit
                    });
                    
                    currentInput = '';
                    currentTimeUnit = '';
                }
                
                timeExpression.push({
                    operator: op
                });
                
                updateDisplayFast();
                return;
            }

            if (currentInput === '' && previousInput === '') {
                return;
            }

            if (previousInput !== '' && currentInput !== '' && !shouldResetDisplay) {
                calculate();
            }

            operator = op;
            previousInput = currentInput || previousInput;
            shouldResetDisplay = true;
            updateDisplayFast();
        }

        function clearAll() {
            currentInput = '';
            previousInput = '';
            operator = '';
            shouldResetDisplay = false;
            currentTimeUnit = '';
            timeExpression = [];
            fastInputMode = false; // Сбрасываем режим быстрого ввода
            clearTimeout(updateDisplayTimeout);
            updateDisplay();
        }

        function clearEntry() {
            if (currentMode === 'time') {
                currentInput = '';
                currentTimeUnit = '';
                updateDisplayFast();
            } else {
                currentInput = '';
                updateDisplayFast();
            }
        }

        function calculate() {
            if (previousInput === '' || currentInput === '' || operator === '') {
                return;
            }

            const prev = parseFloat(previousInput);
            const current = parseFloat(currentInput);
            let result;

            switch (operator) {
                case '+':
                    result = prev + current;
                    break;
                case '-':
                    result = prev - current;
                    break;
                case '*':
                    result = prev * current;
                    break;
                case '/':
                    if (current === 0) {
                        alert('Деление на ноль невозможно!');
                        return;
                    }
                    result = prev / current;
                    break;
                default:
                    return;
            }

            // Format result
            if (result % 1 === 0) {
                currentInput = result.toString();
            } else {
                currentInput = parseFloat(result.toFixed(10)).toString();
            }

            operator = '';
            previousInput = '';
            shouldResetDisplay = true;
            updateDisplay();
        }

        // Time Calculator Functions
        function addTimeUnit(unit) {
            if (currentInput === '') {
                alert('Введите число сначала!');
                return;
            }

            currentTimeUnit = unit;
            updateDisplayFast(); // Быстрое обновление
        }

        function calculate() {
            if (previousInput === '' || currentInput === '' || operator === '') {
                return;
            }

            const prev = parseFloat(previousInput);
            const current = parseFloat(currentInput);
            let result;

            switch (operator) {
                case '+':
                    result = prev + current;
                    break;
                case '-':
                    result = prev - current;
                    break;
                case '*':
                    result = prev * current;
                    break;
                case '/':
                    if (current === 0) {
                        alert('Деление на ноль невозможно!');
                        return;
                    }
                    result = prev / current;
                    break;
                default:
                    return;
            }

            // Format result
            if (result % 1 === 0) {
                currentInput = result.toString();
            } else {
                currentInput = parseFloat(result.toFixed(10)).toString();
            }

            operator = '';
            previousInput = '';
            shouldResetDisplay = true;
            fastInputMode = false; // Сбрасываем режим после вычисления
            clearTimeout(updateDisplayTimeout);
            updateDisplay();
        }

        function updateTimeDisplay() {
            let displayText = '';
            let expression = '';

            // Build expression
            timeExpression.forEach((item, index) => {
                if (item.operator) {
                    expression += ` ${getOperatorSymbol(item.operator)} `;
                } else {
                    if (item.isCurrentTime) {
                        expression += 'Сейчас';
                    } else {
                        expression += `${item.value} ${TIME_LABELS[item.unit]}`;
                    }
                }
            });

            // Add current input if exists
            if (currentInput !== '') {
                if (expression !== '') {
                    expression += ' ';
                }
                expression += `${currentInput}`;
                if (currentTimeUnit !== '') {
                    expression += ` ${TIME_LABELS[currentTimeUnit]}`;
                }
            }

            expressionDisplay.textContent = expression;

            // Calculate and display result
            if (timeExpression.length > 0) {
                const result = calculateTimeExpression();
                displayText = formatTimeResult(result);
            } else if (currentInput !== '') {
                displayText = `${currentInput}${currentTimeUnit ? ' ' + TIME_LABELS[currentTimeUnit] : ''}`;
            } else {
                displayText = '0';
            }

            resultDisplay.textContent = displayText;
        }

        function calculateTimeExpression() {
            let totalSeconds = 0;
            let currentOperation = '+';

            timeExpression.forEach(item => {
                if (item.operator) {
                    currentOperation = item.operator;
                } else {
                    let seconds;
                    if (item.isCurrentTime) {
                        // Если это текущее время, используем значение как есть (уже в секундах)
                        seconds = Math.floor(item.value);
                    } else {
                        // Обычное преобразование
                        seconds = Math.floor(item.value * TIME_UNITS[item.unit]);
                    }
                    
                    switch (currentOperation) {
                        case '+':
                            totalSeconds += seconds;
                            break;
                        case '-':
                            totalSeconds -= seconds;
                            break;
                    }
                }
            });

            return Math.floor(totalSeconds);
        }

        function showCurrentTime() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();
            
            // Сохраняем как базовое время для вычислений (секунды с начала дня)
            const totalSeconds = hours * 3600 + minutes * 60 + seconds;
            
            timeExpression = [{
                value: totalSeconds,
                unit: 'sec',
                isCurrentTime: true,
                originalHours: hours,
                originalMinutes: minutes,
                originalSeconds: seconds
            }];
            
            // Показываем текущее время в дисплее
            const currentTimeText = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            resultDisplay.textContent = currentTimeText;
            expressionDisplay.textContent = `Сейчас:`;
            
            // Очищаем текущий ввод
            currentInput = '';
            currentTimeUnit = '';
        }

        function formatTimeResult(totalSeconds) {
            if (totalSeconds === 0) return '0 сек';
            
            // Проверяем, работаем ли мы с текущим временем (результат вычислений с "Now")
            const hasCurrentTime = timeExpression.some(item => item.isCurrentTime);
            
            if (hasCurrentTime) {
                // Обрабатываем как время суток с возможным переходом через дни
                const isNegative = totalSeconds < 0;
                let absSeconds = Math.abs(totalSeconds);
                
                // Вычисляем дни
                const days = Math.floor(absSeconds / 86400);
                const remainingSeconds = absSeconds % 86400;
                
                // Вычисляем часы, минуты, секунды
                const hours = Math.floor(remainingSeconds / 3600);
                const minutes = Math.floor((remainingSeconds % 3600) / 60);
                const seconds = remainingSeconds % 60;
                
                if (days === 0 && !isNegative) {
                    // Если в пределах одного дня, показываем как время
                    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                } else {
                    // Если есть дни или отрицательное время, показываем полный формат
                    let result = [];
                    if (days > 0) result.push(`${days} дн`);
                    if (hours > 0) result.push(`${hours} ч`);
                    if (minutes > 0) result.push(`${minutes} мин`);
                    if (seconds > 0 || result.length === 0) result.push(`${seconds} сек`);
                    return (isNegative ? '−' : '') + result.join(' ');
                }
            }
            
            // Обычное форматирование для интервалов времени
            const isNegative = totalSeconds < 0;
            totalSeconds = Math.abs(totalSeconds);

            const years = Math.floor(totalSeconds / TIME_UNITS.year);
            const days = Math.floor((totalSeconds % TIME_UNITS.year) / TIME_UNITS.day);
            const hours = Math.floor((totalSeconds % TIME_UNITS.day) / TIME_UNITS.hour);
            const minutes = Math.floor((totalSeconds % TIME_UNITS.hour) / TIME_UNITS.min);
            const seconds = Math.floor(totalSeconds % TIME_UNITS.min);

            let result = [];
            
            if (years > 0) result.push(`${years} ${TIME_LABELS.year}`);
            if (days > 0) result.push(`${days} ${TIME_LABELS.day}`);
            if (hours > 0) result.push(`${hours} ${TIME_LABELS.hour}`);
            if (minutes > 0) result.push(`${minutes} ${TIME_LABELS.min}`);
            if (seconds > 0 || result.length === 0) result.push(`${seconds} ${TIME_LABELS.sec}`);

            // Показываем до 4 компонентов для лучшей читаемости
            return (isNegative ? '−' : '') + result.slice(0, 4).join(' ');
        }

        function calculateTime() {
            if (currentInput !== '' && currentTimeUnit !== '') {
                timeExpression.push({
                    value: parseFloat(currentInput),
                    unit: currentTimeUnit
                });
                currentInput = '';
                currentTimeUnit = '';
            }

            if (timeExpression.length === 0) return;

            const result = calculateTimeExpression();
            
            // Clear and show result
            timeExpression = [];
            resultDisplay.textContent = formatTimeResult(result);
            expressionDisplay.textContent = '';
            currentInput = '';
            currentTimeUnit = '';
        }

        function convertTime() {
            let totalSeconds;
            
            // Определяем что конвертировать
            if (timeExpression.length > 0) {
                // Если есть выражение, конвертируем результат
                totalSeconds = calculateTimeExpression();
            } else if (currentInput !== '' && currentTimeUnit !== '') {
                // Если есть текущий ввод
                const value = parseFloat(currentInput);
                totalSeconds = value * TIME_UNITS[currentTimeUnit];
            } else {
                alert('Введите время для конвертации!');
                return;
            }

            // Показываем полное разложение в дисплее
            const fullBreakdown = getFullTimeBreakdown(totalSeconds);
            resultDisplay.textContent = fullBreakdown;
            expressionDisplay.textContent = `Полное разложение времени:`;
            
            // Очищаем текущий ввод
            currentInput = '';
            currentTimeUnit = '';
            timeExpression = [];
        }

        function getFullTimeBreakdown(totalSeconds) {
            if (totalSeconds === 0) return '0 лет 0 дн 0 ч 0 мин 0 сек';
            
            const isNegative = totalSeconds < 0;
            totalSeconds = Math.abs(totalSeconds);

            const years = Math.floor(totalSeconds / TIME_UNITS.year);
            const remainingAfterYears = totalSeconds % TIME_UNITS.year;
            
            const days = Math.floor(remainingAfterYears / TIME_UNITS.day);
            const remainingAfterDays = remainingAfterYears % TIME_UNITS.day;
            
            const hours = Math.floor(remainingAfterDays / TIME_UNITS.hour);
            const remainingAfterHours = remainingAfterDays % TIME_UNITS.hour;
            
            const minutes = Math.floor(remainingAfterHours / TIME_UNITS.min);
            const seconds = Math.floor(remainingAfterHours % TIME_UNITS.min);

            const result = `${years} лет ${days} дн ${hours} ч ${minutes} мин ${seconds} сек`;
            return isNegative ? `−${result}` : result;
        }

        function clearAll() {
            currentInput = '';
            previousInput = '';
            operator = '';
            shouldResetDisplay = false;
            currentTimeUnit = '';
            timeExpression = [];
            updateDisplay();
        }

        function clearEntry() {
            if (currentMode === 'time') {
                currentInput = '';
                currentTimeUnit = '';
                updateDisplay();
            } else {
                currentInput = '';
                updateDisplay();
            }
        }

        // Keyboard Support
        document.addEventListener('keydown', (event) => {
            const key = event.key;

            if ('0123456789.'.includes(key)) {
                appendNumber(key);
            } else if (key === '+' || key === '-') {
                appendOperator(key);
            } else if (key === '*' || key === '/') {
                // Умножение и деление только для обычного режима
                if (currentMode === 'normal') {
                    appendOperator(key);
                }
            } else if (key === 'Enter' || key === '=') {
                if (currentMode === 'time') {
                    calculateTime();
                } else {
                    calculate();
                }
            } else if (key === 'Escape') {
                clearAll();
            } else if (key === 'Backspace') {
                clearEntry();
            }
        });

        // Touch feedback - оптимизированная версия для быстрого ввода
        document.querySelectorAll('.btn').forEach(button => {
            let isVibrating = false;
            
            button.addEventListener('touchstart', () => {
                // Ограничиваем частоту вибрации для производительности
                if (navigator.vibrate && !isVibrating) {
                    isVibrating = true;
                    navigator.vibrate(75);
                    setTimeout(() => { isVibrating = false; }, 30);
                }
            }, { passive: true }); // passive для лучшей производительности
        });

        // Initialize
        updateDisplay();
        
        // Проверяем, уже ли установлено приложение
        if (window.matchMedia('(display-mode: standalone)').matches || 
            window.navigator.standalone === true) {
            console.log('App is already installed');
            // Скрываем кнопки установки если приложение уже установлено
            if (installBtnHeader) {
                installBtnHeader.style.display = 'none';
            }
        } else {
            // Показываем кнопку установки для неустановленного приложения
            setTimeout(showInstallButton, 500);
        }

        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 5) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // Add fullscreen support for PWA
        if (window.matchMedia('(display-mode: standalone)').matches) {
            document.body.style.paddingTop = 'env(safe-area-inset-top)';
        }
    </script>
</body>
</html>
